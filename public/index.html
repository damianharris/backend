<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>90‑Day Role Transition Agent</title>
  <meta name="description" content="Plan your first 90 days in a new role with a focused, step‑by‑step roadmap."/>
  <style>
    body { font-family: Arial, sans-serif; background: #0b1020; color: #e6edf3; margin: 0; }
    header { padding: 1em; background: #121a2b; text-align: center; }
    .messages { padding: 1em; max-height: 70vh; overflow-y: auto; }
    .bubble { padding: 0.5em 0.75em; margin-bottom: 0.5em; border-radius: 0.5em; max-width: 80%; }
    .user { background: #4f46e5; color: white; margin-left: auto; }
    .bot { background: #1f2937; color: #e6edf3; margin-right: auto; }
    form { display: flex; gap: 0.5em; padding: 1em; background: #121a2b; }
    textarea { flex: 1; padding: 0.5em; border-radius: 0.5em; border: none; }
    button { background: #4f46e5; color: white; padding: 0.5em 1em; border: none; border-radius: 0.5em; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>90‑Day Role Transition Agent by DAMIAN HARRIS</h1>
    <p>Get a 13‑week plan for success in your new role</p>
  </header>
  <main>
    <div id="messages" class="messages"></div>
    <form id="chat-form">
      <textarea id="prompt" placeholder="Describe your new role..." required></textarea>
      <button type="submit">Send</button>
    </form>
  </main>
  <script>
    const form = document.getElementById('chat-form');
    const promptEl = document.getElementById('prompt');
    const messages = document.getElementById('messages');

    function addBubble(text, who) {
      const div = document.createElement('div');
      div.className = 'bubble ' + who;
      div.textContent = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
      return div;
    }

    async function sendMessage(prompt) {
      addBubble(prompt, 'user');
      const botBubble = addBubble('', 'bot');
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt })
      });
      const reader = res.body.getReader();
      const decoder = new TextDecoder();
      let partial = '';
      while (true) {
        const { value, done } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value, { stream: true });
        for (const line of chunk.split('\n')) {
          if (!line.startsWith('data:')) continue;
          const data = line.slice(5).trim();
          if (data === '[DONE]') continue;
          try {
            const json = JSON.parse(data);
            if (json.delta) {
              partial += json.delta;
              botBubble.textContent = partial;
            }
          } catch {}
        }
      }
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const prompt = promptEl.value.trim();
      if (!prompt) return;
      promptEl.value = '';
      sendMessage(prompt);
    });
  </script>
</body>
</html>
